<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°¥ì¤˜ AI - ë©”ë‰´ ì¶”ì²œ ì„œë¹„ìŠ¤</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ì¶”ê°€ëœ ì•ˆë‚´ ë¬¸êµ¬ ìŠ¤íƒ€ì¼ */
        .recommend-text {
            font-size: 12px;
            color: #888;
            margin-top: 8px;
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 8px;
            line-height: 1.4;
        }
        .recommend-text strong {
            color: #03c75a; /* ë„¤ì´ë²„ìƒ‰ ê°•ì¡° */
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ½ï¸ ë°¥ì¤˜ AI ë§ì¶¤ ë©”ë‰´ ì¶”ì²œ</h1>
        <form id="recommendationForm">
            <label for="category">ì›í•˜ëŠ” ë©”ë‰´ ì¹´í…Œê³ ë¦¬:</label>
            <select id="category" name="category" required>
                <option value="" disabled selected>ì„ íƒí•˜ì„¸ìš”</option>
                <option value="í•œì‹">í•œì‹</option>
                <option value="ì¤‘ì‹">ì¤‘ì‹</option>
                <option value="ì¼ì‹">ì¼ì‹</option>
                <option value="ì–‘ì‹">ì–‘ì‹</option>
                <option value="ë¶„ì‹">ë¶„ì‹</option>
                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>

            <label for="age">ë‹¹ì‹ ì˜ ì—°ë ¹ëŒ€:</label>
            <select id="age" name="age" required>
                <option value="" disabled selected>ì„ íƒí•˜ì„¸ìš”</option>
                <option value="10s">10ëŒ€</option>
                <option value="20s">20ëŒ€</option>
                <option value="30s">30ëŒ€</option>
                <option value="40s">40ëŒ€ ì´ìƒ</option>
            </select>

            <label for="budget">ì˜ˆìƒ ì˜ˆì‚° ë²”ìœ„:</label>
            <select id="budget" name="budget" required>
                <option value="" disabled selected>ì„ íƒí•˜ì„¸ìš”</option>
                <option value="Low">ì €ì˜ˆì‚° (1ë§Œì› ì´í•˜)</option>
                <option value="Mid">ì¤‘ê°„ ì˜ˆì‚° (1ë§Œì› ~ 2ë§Œì›)</option>
                <option value="High">ê³ ì˜ˆì‚° (2ë§Œì› ì´ˆê³¼)</option>
            </select>

            <button type="submit">ë©”ë‰´ ì¶”ì²œë°›ê¸°</button>
        </form>

        <div id="resultContainer">
        </div>
    </div>

    <script>
        // GitHub ë°ì´í„° URL
        const DB_URL = 'https://raw.githubusercontent.com/eatpeoples/eatpeopls-location/main/menu_db.json'; 

        const form = document.getElementById('recommendationForm');
        const resultContainer = document.getElementById('resultContainer');

        // âœ… ê²€ìƒ‰ì–´ ë³´ì • ì‚¬ì „ (ì§€ì†ì  ì—…ë°ì´íŠ¸ ëŒ€ìƒ)
        const searchFixes = {
            "í•´ì‚°ë¬¼ ìŠ¤íŠœ": "ì–‘ì‹ ë§›ì§‘",
            "ì—ê·¸ ë² ë„¤ë”•íŠ¸": "ë¸ŒëŸ°ì¹˜ ì¹´í˜",
            "ê¹€ë°¥ì²œêµ­ ë¼ë©´": "ë¶„ì‹",
            "ê°ë°”ìŠ¤ ì•Œ ì•„íˆìš”": "ê°ë°”ìŠ¤",
            "ë§ˆì¹´ë¡± 10êµ¬": "ë§ˆì¹´ë¡±"
        };

        function checkBudget(price, budgetType) {
            const p = Number(price); 
            if (budgetType === 'Low') return p <= 10000;
            if (budgetType === 'Mid') return p > 10000 && p <= 20000;
            if (budgetType === 'High') return p > 20000;
            return false;
        }

        function cleanMenuName(name) {
            let cleaned = name.replace(/\(.*\)/gi, '');
            const removeWords = ["ì„¸íŠ¸", "ì •ì‹", "ì½¤ë³´", "1ì¸", "íŒ¨ë°€ë¦¬", "ë¯¸ë‹ˆ", "ë°˜ë§ˆë¦¬", "í•œë§ˆë¦¬", "ê¸°ë³¸", "ë°•ìŠ¤"];
            removeWords.forEach(word => {
                cleaned = cleaned.replace(word, '');
            });
            // ìˆ«ì+ë‹¨ìœ„ ì œê±° (10êµ¬, 3p ë“±)
            cleaned = cleaned.replace(/\d+[êµ¬ê°œp]/gi, ''); 
            return cleaned.trim();
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            resultContainer.innerHTML = `
                <div class="result">
                    <div class="loading">ğŸ³ AIê°€ ë§›ìˆëŠ” ë©”ë‰´ë¥¼ ê³ ë¥´ê³  ìˆì–´ìš”...</div>
                </div>`;

            const selectedCategory = document.getElementById('category').value;
            const selectedAge = document.getElementById('age').value;
            const selectedBudget = document.getElementById('budget').value;

            try {
                const response = await fetch(DB_URL);
                if (!response.ok) throw new Error("DB íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                const allMenu = await response.json();

                const filteredMenu = allMenu.filter(item => {
                    return item.Category === selectedCategory && 
                           item.Recommended_Age === selectedAge &&
                           checkBudget(item.Price, selectedBudget);
                });

                if (filteredMenu.length > 0) {
                    const topTierCount = Math.min(filteredMenu.length, 10);
                    const topTierMenu = filteredMenu.slice(0, topTierCount);
                    const randomPick = topTierMenu[Math.floor(Math.random() * topTierMenu.length)];
                    const formattedPrice = Number(randomPick.Price).toLocaleString();

                    // í…ìŠ¤íŠ¸ ë³€í™˜ê¸°
                    const ageMap = { "10s": "10ëŒ€", "20s": "20ëŒ€", "30s": "30ëŒ€", "40s": "40ëŒ€+" };
                    const displayAge = ageMap[randomPick.Recommended_Age] || randomPick.Recommended_Age;

                    const weatherMap = {
                        "Clear": "â˜€ï¸ ë§‘ì€ ë‚ ", "Rain": "â˜” ë¹„ ì˜¤ëŠ” ë‚ ", "Hot": "ğŸ”¥ ë”ìš´ ë‚ ", 
                        "Cold": "â„ï¸ ì¶”ìš´ ë‚ ", "Cloudy": "â˜ï¸ íë¦° ë‚ "
                    };
                    const displayWeather = weatherMap[randomPick.Weather_Tag] || randomPick.Weather_Tag;
                    
                    const healthMap = {
                        "Balanced": "ğŸ¥— ê· í˜•ì¡íŒ", "High-Protein": "ğŸ’ª ê³ ë‹¨ë°±", 
                        "Diet": "light ë‹¤ì´ì–´íŠ¸", "Heavy": "ğŸ– ë“ ë“ í•œ", "Sweet": "ğŸ­ ë‹¬ë‹¬í•œ"
                    };
                    const displayHealth = healthMap[randomPick.Health_Tag] || randomPick.Health_Tag;

                    // ì§€ë„ ê²€ìƒ‰ í‚¤ì›Œë“œ ì„¤ì •
                    const cleanName = cleanMenuName(randomPick.Menu_Name);
                    let baseKeyword = searchFixes[cleanName];
                    if (!baseKeyword) {
                        baseKeyword = cleanName + " ë§›ì§‘";
                    }
                    const searchKeyword = baseKeyword; 
                    const schoolMapUrl = `https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent('ëŒ€ì „ ê¶ë™ ' + searchKeyword)}`;

                    resultContainer.innerHTML = `
                        <div class="result">
                            <div style="font-size: 48px; margin-bottom: 10px;">${randomPick.Emoji}</div>
                            <h2>ì˜¤ëŠ˜ì˜ ì¶”ì²œ: <span class="highlight">${randomPick.Menu_Name}</span></h2>
                            
                            <div class="ai-comment-box">
                                "${randomPick.AI_Comment}"
                            </div>

                            <p>ğŸ·ï¸ ì¹´í…Œê³ ë¦¬: ${randomPick.Category}</p>
                            <p>ğŸ’° ê°€ê²©: <strong>${formattedPrice}ì›</strong></p>
                            
                            <div style="margin-top: 15px; margin-bottom: 15px;">
                                <span class="tag-badge">#${displayAge}í”½</span>
                                <span class="tag-badge">#${displayHealth}</span>
                                <span class="tag-badge">#${displayWeather}</span>
                            </div>

                            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                            
                            <p style="font-size:14px; font-weight:bold; margin-bottom:5px;">ğŸ“ ë‚´ ì£¼ë³€ ì‹ë‹¹ ì°¾ê¸° (GPS)</p>
                            <div class="map-btn-group">
                                <button onclick="openMapWithGPS('NAVER', '${searchKeyword}')" class="map-btn" style="background:#03c75a; color:white;">
                                    N ë‚´ ìœ„ì¹˜ ê²€ìƒ‰
                                </button>
                                <button onclick="openMapWithGPS('KAKAO', '${searchKeyword}')" class="map-btn" style="background:#fee500; color:black;">
                                    K ë‚´ ìœ„ì¹˜ ê²€ìƒ‰
                                </button>
                            </div>
                            
                            <p class="recommend-text">
                                ğŸ’¡ <strong>Tip:</strong> ì¹´ì¹´ì˜¤ë§µì€ ìœ„ì¹˜ê°€ ì •í™•í•˜ì§€ ì•Šì„ ìˆ˜ ìˆì–´ìš”.<br>
                                ì •í™•í•œ ê²€ìƒ‰ì„ ì›í•˜ì‹œë©´ <strong>'N ì§€ë„'</strong>ë‚˜ ì•„ë˜ <strong>'í•™êµ ì• ì°¾ê¸°'</strong>ë¥¼ ì´ìš©í•´ ì£¼ì„¸ìš”!
                            </p>

                            <div style="margin-top: 15px;">
                                 <a href="${schoolMapUrl}" target="_blank" style="flex:1; text-decoration:none;">
                                    <button class="map-btn" style="background:#fff; border:1px solid #ddd; color:#333;">ğŸ« ì¶©ë‚¨ëŒ€(ê¶ë™) ë§›ì§‘ ì°¾ê¸°</button>
                                </a>
                            </div>

                            <button onclick="shareResult('${randomPick.Menu_Name}', '${randomPick.AI_Comment}', '${formattedPrice}')" style="margin-top:20px; background:#555; color:white;">
                                ğŸ“¢ ì¹œêµ¬ì—ê²Œ ê²°ê³¼ ê³µìœ í•˜ê¸°
                            </button>
                        </div>
                    `;
                } else {
                    resultContainer.innerHTML = `
                        <div class="result">
                            <h3>ğŸ¥² ì¡°ê±´ì— ë§ëŠ” ë©”ë‰´ê°€ ì—†ì–´ìš”.</h3>
                            <p>ì¹´í…Œê³ ë¦¬ë‚˜ ì˜ˆì‚°ì„ ì¡°ê¸ˆ ë³€ê²½í•´ì„œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”!</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error:', error);
                resultContainer.innerHTML = `
                    <div class="result">
                        <p>ğŸš¨ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨!</p>
                        <p style="font-size:12px; color:red;">GitHub ì£¼ì†Œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                    </div>`;
            }
        });

        // âœ… GPS ì§€ë„ ê²€ìƒ‰ í•¨ìˆ˜ (ì¹´ì¹´ì˜¤ "ëŒ€ì „" ê°•ì œ ê³ ì • í•´ì œ -> GPS ì‹œë„)
        function openMapWithGPS(type, keyword) {
            
            if (!navigator.geolocation) {
                alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                fallbackMap(type, keyword);
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    if (type === 'NAVER') {
                        // ë„¤ì´ë²„: ì¢Œí‘œ(&c) ì‚¬ìš©
                        const url = `https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(keyword)}&c=${lng},${lat},15`;
                        window.open(url, '_blank');
                    } else {
                        // âœ… ì¹´ì¹´ì˜¤ ìˆ˜ì •: "ëŒ€ì „" ëºìŠµë‹ˆë‹¤! ê·¸ëƒ¥ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰ (GPSì— ë§¡ê¹€)
                        // ëŒ€ì‹  ìœ„ì—ì„œ ì•ˆë‚´ ë¬¸êµ¬ë¡œ ë¦¬ìŠ¤í¬ë¥¼ ë°©ì–´í–ˆìŠµë‹ˆë‹¤.
                        const url = `https://m.map.kakao.com/actions/searchView?q=${encodeURIComponent(keyword)}`;
                        window.open(url, '_blank');
                    }
                },
                (error) => {
                    fallbackMap(type, keyword);
                }
            );
        }

        function fallbackMap(type, keyword) {
            // ì‹¤íŒ¨ ì‹œ ì•ˆì „í•˜ê²Œ "ë‚´ ì£¼ë³€" ë¶™ì´ê¸°
            const query = "ë‚´ ì£¼ë³€ " + keyword;
            
            if (type === 'NAVER') {
                const url = `https://m.map.naver.com/search2/search.naver?query=${encodeURIComponent(query)}`;
                window.open(url, '_blank');
            } else {
                const url = `https://m.map.kakao.com/actions/searchView?q=${encodeURIComponent(query)}`;
                window.open(url, '_blank');
            }
        }

        function shareResult(menuName, comment, price) {
            const text = `[ë°¥ì¤˜ AI ì¶”ì²œ]\nğŸ½ï¸ ì˜¤ëŠ˜ì˜ ë©”ë‰´: ${menuName}\nğŸ’° ê°€ê²©: ${price}ì›\nğŸ—£ï¸ AI í•œì¤„í‰: "${comment}"\n\në„ˆë„ ì¶”ì²œë°›ìœ¼ëŸ¬ ì™€! ğŸ‘‡`;
            const url = window.location.href;
            navigator.clipboard.writeText(`${text}\n${url}`).then(() => {
                alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ì¹´í†¡ë°©ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”! ğŸ‘");
            }).catch(err => {
                alert("ë³µì‚¬ ì‹¤íŒ¨ ã… ã…  í™”ë©´ì„ ìº¡ì²˜í•´ì„œ ê³µìœ í•´ì£¼ì„¸ìš”.");
            });
        }
    </script>
</body>
</html>
